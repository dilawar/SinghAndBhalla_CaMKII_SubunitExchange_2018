% ===================================================================================
% 
%     Description:  Effect of subunit-exchange on turnover rate.
% 
%          Author:  Dilawar Singh (), dilawars@ncbs.res.in
%    Organization:  NCBS Bangalore
%       Copyright:  Copyright (c) 2018, Dilawar Singh
% 
%           Notes:  
% 
% ===================================================================================

\RequirePackage{luatex85,shellesc}
\documentclass[multi=false,varwidth=178mm,class=../pnas-new,crop=true]{standalone}
\usepackage{amsmath,amssymb}
\usepackage{pgfplots}
\usepackage{grffile}
\pgfplotsset{compat=newest}
\usepackage{tabularx}
\usepackage{array}
\usepackage[small,euler-digits]{eulervm}
\renewcommand\familydefault{\sfdefault}
\usepgfplotslibrary{units}
\usetikzlibrary{calc,positioning}
\usepackage{siunitx}
\pgfplotsset{
    , xtick align=center
    , ytick align=center
    , unit markings=parenthesis
    , legend style={fill=none,draw=none , font=\footnotesize, at={(1,1)}, anchor=south east}
    , tick label style={font=\scriptsize}
}


\begin{document}

\pgfmathsetmacro{\figW}{17.8}
\pgfmathsetmacro{\colW}{\figW/3}
\pgfmathsetmacro{\plotW}{0.95*\colW}
\pgfmathsetmacro{\plotH}{2.8}

\pgfplotsset{ 
    axis lines=left
    , title style={font=\small}
    , axis line style={-}
}
\pgfplotsset{every axis/.append style={width=\plotW cm, height=\plotH cm,}}
% \tikzset{node distance=15mm,inner sep=1pt}

% \colW cm.

\begin{tabularx}{\figW cm}{X X X}
    \begin{tikzpicture}[scale=1]
        \begin{axis}[name=plota1 
            , width=\plotW cm, height= \plotH cm
            , title = {Without Subunit-Exchange (-SE)}
            , title style={yshift=3mm}
            , ymax = 1, ytick={0,1}
            , enlarge y limits={abs=0.1}
            , enlarge x limits={abs=1}
        ]
            \addplot [color=red] gnuplot [ raw gnuplot ] {
                plot "./data_(turnover=30,SU=OFF).dat_processed.dat" 
                    using (column("time")/86400):(column("CaMKII*")/10) every 5;
            };
            \legend{${v_t}=1/30 \si{\per \hour}$}
        \end{axis}
        \node[above left=of plota1.north west, xshift=5mm] {\bf A};
        \begin{axis}[name=plota11, at={(plota1.south)}, anchor = north
                , height=\plotH cm, yshift=-10mm
                , ylabel=Active CaMKII Fraction
                , ymax = 1, ytick={0,1}
                , enlarge y limits={abs=0.1}
                , enlarge x limits={abs=1}
                % , xtick=\empty
            ]
            \addplot [color=red!90!black] gnuplot [ raw gnuplot ] {
                plot "./data_(turnover=3,SU=OFF).dat_processed.dat" 
                    using (column("time")/86400):(column("CaMKII*")/10) every 5;
            };
            \legend{${v_t}=1/3 \si{\per \hour}$}
        \end{axis}
        \begin{axis}[name=plota12, at={(plota11.south)}, anchor = north
                , height=\plotH cm, yshift=-10mm
                , xlabel=Time, x unit=day
                , ymax = 1, ytick={0,1}
                , enlarge y limits={abs=0.1}
                , enlarge x limits={abs=1}
            ]
            \addplot [color=red!80!black] gnuplot [ raw gnuplot ] {
                plot "./data_(turnover=0.5,SU=OFF).dat_processed.dat" 
                    using (column("time")/86400):(column("CaMKII*")/10) every 5;
            };
            \legend{${v_t}=1/0.5 \si{\per \hour}$}
        \end{axis}
    \end{tikzpicture} 
    &
    % second subplot 1st column, 2nd row.
    \begin{tikzpicture}[scale=1]
        \begin{axis}[name=plota1 
            , width=\plotW cm, height= \plotH cm
            , title = {With Subunit Exchange (+SE)}
            , title style={yshift=3mm}
            , ymax = 1, ytick={0,1}
            , enlarge y limits={abs=0.1}
            , enlarge x limits={abs=1}
            % , xtick=\empty
        ]
            \addplot [color=blue] gnuplot [ raw gnuplot ] {
                plot "./data_(turnover=30,SU=ON).dat_processed.dat" 
                    using (column("time")/86400):(column("CaMKII*")/10) every 5;
            };
            \legend{${v_t}=1/30 \si{\per \hour}$}
        \end{axis}
        \begin{axis}[name=plota11, at={(plota1.south)}, anchor = north
                , height=\plotH cm, yshift=-10mm
                , ylabel=Active CaMKII Fraction
                , ymax = 1, ytick={0,1}
                , enlarge y limits={abs=0.1}
                , enlarge x limits={abs=1}
                % , xtick=\empty
            ]
            \addplot [color=blue!90!black] gnuplot [ raw gnuplot ] {
                plot "./data_(turnover=3,SU=ON).dat_processed.dat" 
                    using (column("time")/86400):(column("CaMKII*")/10) every 5;
            };
            \legend{${v_t}=1/3 \si{\per \hour}$}
        \end{axis}

        \begin{axis}[name=plota12, at={(plota11.south)}, anchor = north
                , height=\plotH cm, yshift=-10mm
                , xlabel=Time, x unit=day
                , ymax = 1, ytick={0,1}
                , enlarge y limits={abs=0.1}
                , enlarge x limits={abs=1}
            ]
            \addplot [color=blue!80!black] gnuplot [ raw gnuplot ] {
                plot "./data_(turnover=0.5,SU=ON).dat_processed.dat" 
                    using (column("time")/86400):(column("CaMKII*")/10) every 5;
            };
            \legend{${v_t}=1/0.5 \si{\per \hour}$}
        \end{axis}
    \end{tikzpicture} 
    &
    \begin{tikzpicture}[ ]
        \edef\plotH{3}
        % Another node just below of A. Effect of SE on turnover.
        \begin{semilogxaxis}[name=plotb1
                , xlabel=Turnover rate, x unit=\si{\per \hour}
                , ylabel={Fraction of time \\  spent in {\tt ON} state}
                , ylabel style={align=center,font=\small}
                , width=0.8*\plotW cm, height=\plotH cm %, scale only axis
                , legend style={font=\scriptsize, at={(0.4,1)}, anchor=south west}
                , enlargelimits=true
                , legend columns=1
            ]
            \addplot [blue, thick, mark=o, mark size=2pt] table 
                [col sep=comma, x=x_ON, y=KramerON_ON] 
                {./camkii6_data_effect_of_turnover.csv};
            \addplot [blue, thick, mark=star, mark size=2pt] table 
                [col sep=comma, x=x_ON, y=KramerON_ON] 
                {./camkii12_data_effect_of_turnover.csv};
            \addplot [red, thick, mark=o, mark size=2pt] table 
                [col sep=comma, x=x_OFF, y=KramerON_OFF] 
                {./camkii6_data_effect_of_turnover.csv};
            \addplot [red, thick, mark=star, mark size=2pt] table 
                [col sep=comma, x=x_OFF, y=KramerON_OFF] 
                {./camkii12_data_effect_of_turnover.csv};
            \legend{$N_{\text{CaMKII}}=6$ (+SE), $N_{\text{CaMKII}}=12$(+SE)
                ,$N_{\text{CaMKII}}=6$ (-SE), $N_{\text{CaMKII}}=12$(-SE)}
        \end{semilogxaxis}
        \node[above left=of plotb1.north west] {\bf B};
        \begin{loglogaxis}[ name=plotb2
                , at={(plotb1.south west)}, anchor=north west, yshift=-28mm
                , xlabel=Turnover rate, x unit=\si{\per \hour}
                , ylabel={Number of \\ transitions}
                , ylabel style={align=center}
                , width=0.8*\plotW cm, height=\plotH cm %, scale only axis
                , legend style={font=\scriptsize, at={(0.4,1)}, anchor=south west}
                , enlargelimits=true
                , legend columns=1
                , unbounded coords=jump
            ]
            % NOTE: Monday 09 July 2018 01:34:09 PM IST
            % These curves also have non-bistable region in them. We need to
            % prone them out to reduce the confusion. 
            % Or only plot solid line in bistable regime. 

            % This also have mono-stable regime.
            \addplot [blue, thick, mark=o, mark size=2pt, ] 
                table [ col sep=comma, x=x_ON, y=transitions_ON
                , x expr={\thisrow{x_ON}<=2?\thisrow{x_ON}:nan}
                ]{./camkii6_data_effect_of_turnover.csv};

            \addplot [blue, mark=o, mark size=2pt, densely dotted] 
                table [ col sep=comma, x=x_ON, y=transitions_ON
                    , x expr={\thisrow{x_ON}>=2?\thisrow{x_ON}:nan}
                ]{./camkii6_data_effect_of_turnover.csv};

            \addplot [blue, thick, mark=star, mark size=2pt, ] table 
                [col sep=comma, x=x_ON, y=transitions_ON] 
                {./camkii12_data_effect_of_turnover.csv};

            \addplot [red, thick, mark=o, mark size=2pt] table 
                [col sep=comma, y=transitions_OFF
                    , x expr={\thisrow{x_OFF}>0.2?nan:\thisrow{x_OFF}}
                ]{./camkii6_data_effect_of_turnover.csv};
            \addplot [red, thick, mark=star, mark size=2pt] table 
                [col sep=comma, x=x_OFF, y=transitions_OFF
                    , x expr={\thisrow{x_OFF}>0.2?nan:\thisrow{x_OFF}}
                ] {./camkii12_data_effect_of_turnover.csv};

            % Plot the rest of point with dotted thin line.
            \addplot [red, mark=o, mark size=2pt, 
                , densely dotted] table [col sep=comma, y=transitions_OFF
                    , x expr={\thisrow{x_OFF}<0.2?nan:\thisrow{x_OFF}}
                ]{./camkii6_data_effect_of_turnover.csv};
            \addplot [red, mark=star, mark size=2pt, 
                , densely dotted] table 
                [col sep=comma, x=x_OFF, y=transitions_OFF
                    , x expr={\thisrow{x_OFF}<0.2?nan:\thisrow{x_OFF}}
                ]{./camkii12_data_effect_of_turnover.csv};
            \legend{$N_{\text{CaMKII}}=6$ (+SE),,$N_{\text{CaMKII}}=12$(+SE)
                    ,$N_{\text{CaMKII}}=6$ (-SE), $N_{\text{CaMKII}}=12$(-SE)}
        \end{loglogaxis}
        \node[above left=of plotb2.north west] {\bf C};
    \end{tikzpicture}
\end{tabularx}

\end{document}

