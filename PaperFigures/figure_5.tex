% ===================================================================================
% 
%     Description:  Effect of subunit-exchange on turnover rate.
% 
%          Author:  Dilawar Singh (), dilawars@ncbs.res.in
%    Organization:  NCBS Bangalore
%       Copyright:  Copyright (c) 2018, Dilawar Singh
% 
%           Notes:  
% 
% ===================================================================================

\RequirePackage{luatex85,shellesc}
\documentclass[preview,multi=false,varwidth=11.4cm,class=../pnas-new]{standalone}
\usepackage{amsmath,amssymb}
\usepackage{pgfplots}
\usepackage{grffile}
\pgfplotsset{compat=newest}
\usepackage{tabularx}
\usepackage[small,euler-digits]{eulervm}
\renewcommand\familydefault{\sfdefault}
\usepgfplotslibrary{units}
\usetikzlibrary{calc,positioning}
\usepackage{siunitx}
\pgfplotsset{
    , xtick align=center
    , ytick align=center
    , unit markings=parenthesis
    , legend style={fill=none,draw=none,font=\footnotesize}
}


\begin{document}

\pgfmathsetmacro{\figW}{11.4}
\pgfmathsetmacro{\colW}{0.5*\figW}
\pgfmathsetmacro{\plotW}{0.92*\colW}
\pgfmathsetmacro{\plotH}{2.5}

\pgfplotsset{axis lines=left}
\pgfplotsset{ axis lines=left
    , legend style={fill=none,draw=none}
    , title style={font=\small}
    , axis line style={-}
}
\pgfplotsset{every axis/.append style={width=\plotW cm, height=\plotH cm,}}
\tikzset{
    every label/.style={xshift=5mm,font=\large}
}

\begin{tabularx}{\figW cm}{p{\plotW cm} p{\plotW cm}}
        \begin{tikzpicture}[scale=1]
            \begin{axis}[name=plota1 
                , width=\plotW cm, height= \plotH cm
                , legend style={at={(1,1.5)}}
                , title = {Without Subunit-Exchange (-SE)}
                , title style={yshift=3mm}
                , ymax = 1, ytick={0,1}
                , enlarge y limits={abs=0.1}
                , enlarge x limits={abs=1}
                , xtick=\empty
            ]
                \addplot [color=red] gnuplot [ raw gnuplot ] {
                    plot "./data_(turnover=30,SU=OFF).dat_processed.dat" 
                        using (column("time")/86400):(column("CaMKII*")/10) every 5;
                };
                \legend{$v_{v_t}=1/30 \si{\per \hour}$}
            \end{axis}
            \node[above left=of plota1.north west] {\bf A};
            \begin{axis}[name=plota11, at={(plota1.south)}, anchor = north
                    , height=\plotH cm, yshift=-5mm
                    , ylabel=Active CaMKII Fraction
                    , ymax = 1, ytick={0,1}
                    , enlarge y limits={abs=0.1}
                    , enlarge x limits={abs=1}
                    , legend style={at={(1,1.5)}}
                    , xtick=\empty
                ]
                \addplot [color=red!90!black] gnuplot [ raw gnuplot ] {
                    plot "./data_(turnover=3,SU=OFF).dat_processed.dat" 
                        using (column("time")/86400):(column("CaMKII*")/10) every 5;
                };
                \legend{$v_{v_t}=1/3 \si{\per \hour}$}
            \end{axis}

            \begin{axis}[name=plota12, at={(plota11.south)}, anchor = north
                    , height=\plotH cm, yshift=-5mm
                    , xlabel=Time, x unit=day
                    , ymax = 1, ytick={0,1}
                    , enlarge y limits={abs=0.1}
                    , enlarge x limits={abs=1}
                    , legend style={at={(1,1.5)}}
                ]
                \addplot [color=red!80!black] gnuplot [ raw gnuplot ] {
                    plot "./data_(turnover=0.5,SU=OFF).dat_processed.dat" 
                        using (column("time")/86400):(column("CaMKII*")/10) every 5;
                };
                \legend{$v_{v_t}=1/0.5 \si{\per \hour}$}
            \end{axis}
        \end{tikzpicture} 
        &
        % second subplot 1st column, 2nd row.
        \begin{tikzpicture}[scale=1]
            \begin{axis}[name=plota1 
                , width=\plotW cm, height= \plotH cm
                , legend style={at={(1,1.5)}}
                , title = {With Subunit Exchange (+SE)}
                , title style={yshift=3mm}
                , ymax = 1, ytick={0,1}
                , enlarge y limits={abs=0.1}
                , enlarge x limits={abs=1}
                , xtick=\empty
            ]
                \addplot [color=blue] gnuplot [ raw gnuplot ] {
                    plot "./data_(turnover=30,SU=ON).dat_processed.dat" 
                        using (column("time")/86400):(column("CaMKII*")/10) every 5;
                };
                \legend{$v_{v_t}=1/30 \si{\per \hour}$}
            \end{axis}
            \node[above left=of plota1.north west] {\bf B};
            \begin{axis}[name=plota11, at={(plota1.south)}, anchor = north
                    , height=\plotH cm, yshift=-5mm
                    , ylabel=Active CaMKII Fraction
                    , ymax = 1, ytick={0,1}
                    , enlarge y limits={abs=0.1}
                    , enlarge x limits={abs=1}
                    , legend style={at={(1,1.5)}}
                    , xtick=\empty
                ]
                \addplot [color=blue!90!black] gnuplot [ raw gnuplot ] {
                    plot "./data_(turnover=3,SU=ON).dat_processed.dat" 
                        using (column("time")/86400):(column("CaMKII*")/10) every 5;
                };
                \legend{$v_{v_t}=1/3 \si{\per \hour}$}
            \end{axis}

            \begin{axis}[name=plota12, at={(plota11.south)}, anchor = north
                    , height=\plotH cm, yshift=-5mm
                    , xlabel=Time, x unit=day
                    , ymax = 1, ytick={0,1}
                    , enlarge y limits={abs=0.1}
                    , enlarge x limits={abs=1}
                    , legend style={at={(1,1.5)}}
                ]
                \addplot [color=blue!80!black] gnuplot [ raw gnuplot ] {
                    plot "./data_(turnover=0.5,SU=ON).dat_processed.dat" 
                        using (column("time")/86400):(column("CaMKII*")/10) every 5;
                };
                \legend{$v_{v_t}=1/0.5 \si{\per \hour}$}
            \end{axis}
        \end{tikzpicture} 
        \\
    \begin{tikzpicture}[ ]
        % Another node just below of A. Effect of SE on turnover.
        \begin{semilogxaxis}[name=plotb1
                , xlabel=Turnover rate, x unit=\si{\per \hour}
                , ylabel={Fraction of time \\  spent in {\tt ON} state}
                , ylabel style={align=center,font=\small}
                , width=\plotW cm, height=1.5*\plotH cm %, scale only axis
                , legend style={font=\tiny, fill=none, draw=none, at={(1,1.5)} }
                , enlargelimits=true
                , legend columns=1
            ]
            \addplot [blue, thick, mark=o, mark size=2pt] table 
                [col sep=comma, x=x_ON, y=KramerON_ON] 
                {./camkii6_data_effect_of_turnover.csv};
            \addplot [blue, thick, mark=star, mark size=2pt] table 
                [col sep=comma, x=x_ON, y=KramerON_ON] 
                {./camkii12_data_effect_of_turnover.csv};
            \addplot [red, thick, mark=o, mark size=2pt] table 
                [col sep=comma, x=x_OFF, y=KramerON_OFF] 
                {./camkii6_data_effect_of_turnover.csv};
            \addplot [red, thick, mark=star, mark size=2pt] table 
                [col sep=comma, x=x_OFF, y=KramerON_OFF] 
                {./camkii12_data_effect_of_turnover.csv};

            % \legend{$N_{CaMKII}=6$ (+SE), $N_{CaMKII}=12$(+SE),$N_{CaMKII}=6$ (-SE), $N_{CaMKII}=12$(-SE)}
            \legend{$N_{\text{CaMKII}}=6$ (+SE), $N_{\text{CaMKII}}=12$(+SE)
                ,$N_{\text{CaMKII}}=6$ (-SE), $N_{\text{CaMKII}}=12$(-SE)}
        \end{semilogxaxis}
        \node[above left=of plotb1.north west] {\bf C};
    \end{tikzpicture}
    &
    \begin{tikzpicture}[ ]
        \begin{semilogxaxis}[ name=plotb2
                , xlabel=Turnover rate, x unit=\si{\per \hour}
                , ylabel={Number of transitions}
                , ylabel style={align=center}
                , width=\plotW cm,height=1.5*\plotH cm %, scale only axis
                , legend style={font=\tiny, fill=none, draw=none, at={(1,1.5)} }
                , enlargelimits=true
                , legend columns=1
            ]
            \addplot [blue, thick, mark=o, mark size=2pt] table 
                [col sep=comma, x=x_ON, y=transitions_ON] 
                {./camkii6_data_effect_of_turnover.csv};
            \addplot [blue, thick, mark=star, mark size=2pt] table 
                [col sep=comma, x=x_ON, y=transitions_ON] 
                {./camkii12_data_effect_of_turnover.csv};
            \addplot [red, thick, mark=o, mark size=2pt] table 
                [col sep=comma, x=x_OFF, y=transitions_OFF] 
                {./camkii6_data_effect_of_turnover.csv};
            \addplot [red, thick, mark=star, mark size=2pt] table 
                [col sep=comma, x=x_OFF, y=transitions_OFF] 
                {./camkii12_data_effect_of_turnover.csv};

                \legend{$N_{\text{CaMKII}}=6$ (+SE), $N_{\text{CaMKII}}=12$(+SE)
                    ,$N_{\text{CaMKII}}=6$ (-SE), $N_{\text{CaMKII}}=12$(-SE)}
        \end{semilogxaxis}
        \node[above left=of plotb2.north west] {\bf D};
    \end{tikzpicture}
\end{tabularx}

\end{document}

